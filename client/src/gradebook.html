<template>
  <require from="./converters/score-format"></require>
  <require from="./resources/autocomplete"></require>


  <ul class="nav nav-tabs">
    <li>
      <h4>Subjects</h4>
    </li>
    <li repeat.for="sub of subjects" role="presentation"
    class="${sub.id === assignments[0].subjid ? 'active' : ''}">
      <a href="" click.delegate="getAssignments(sub.id)">${ sub.name }</a>
    </li>
  </ul>
  <!-- Subject Menu Bar -->
  <div class="row" show.bind="assignments">
    <ul class="nav nav-pills">
      <li role="presentation">
        <a href="#"><i class="fa fa-plus fa-lg"></i> Add Assignment</a>
      </li>
      <li role="presentation" show.bind="scores" class="${quickmode ? 'active' : ''}">
        <a href="#" click.delegate="toggleQuick()"><i class="fa fa-fast-forward"></i> Quick Entry</a>
      </li>
    </ul>
  </div>
    <div class='row'>
      <div class='col-md-2'>
        <h5 show.bind="assignments">Assignments</h5>
        <ul class="nav nav-pills nav-stacked">
          <li repeat.for="assign of assignments" role="presentation"
          class="${assign.id === assignmentMeta.id ? 'active' : ''}">
            <a href="" click.delegate="getScores(assign.id)">${ assign.name }</a>
          </li>
        </ul>
      </div>

      <div class='col-md-4'>
        <h5 show.bind="scores">Scores</h5>
        <table class="table table-hover" show.bind="scores && !quickmode">
          <thead>
          <tr>
            <th></th>
            <th class='text-center'>${ assignmentMeta.type }
              <small show.bind="assignmentMeta.type == 'Points'">
                (max: ${assignmentMeta.max})</small></th>
          </tr>
          </thead>
            <tr repeat.for="score of scores">
              <td class="text-center">${ score.studref.first_name }</td>
              <td class="text-center" click.delegate="editScore(score)">
                <!-- View Mode -->
                <div if.bind="score.id !== editScoreId">
                  ${ score.value  | scoreFormat: assignmentMeta}
                  <i if.bind="score.value === 1 && assignmentMeta.type === 'Checks'" class="fa fa-check-circle-o fa-2x" aria-hidden="true"></i>
                  <i if.bind="score.value === 0 && assignmentMeta.type === 'Checks'" class="fa fa-circle-o fa-2x" aria-hidden="true"></i>
                </div>

                <!-- Edit Mode -->
                <div if.bind="score.id === editScoreId">
                    <input keypress.delegate="updateScore($event.which, score.id, score.value)"
                    focus.bind="editFocus" blur.trigger="updateScore('blurred', score.id, score.value)"
                    value.bind="score.value" type="number" style="width: 3.5em">
                </div>
              </td>
            </tr>
        </table>

        <!-- Quick Entry Mode -->
        <table class='table table-hover' if.bind="quickmode">
          <thead>
            <tr>
              <th></th>
              <th class='text-center'>${ assignmentMeta.type }
                <small show.bind="assignmentMeta.type == 'Points'">
                  (max: ${assignmentMeta.max})</small></th>
            </tr>
          </thead>
          <tr repeat.for="score of entered">
            <td class="text-center">${ score.studref.first_name }</td>
            <td class="text-center">
              ${ score.value  | scoreFormat: assignmentMeta}
              <i if.bind="score.value === 1 && assignmentMeta.type === 'Checks'" class="fa fa-check-circle-o fa-2x" aria-hidden="true"></i>
              <i if.bind="score.value === 0 && assignmentMeta.type === 'Checks'" class="fa fa-circle-o fa-2x" aria-hidden="true"></i>
            </td>
          </tr>
          <tr>
            <td class="text-center">
              <!-- Name Input -->
                <div class="form-group">
                  <autocomplete service.bind="suggestionService"
                                value.bind="quickName"
                                placeholder="Name"
                                quick-name-focus.bind="quickNameFocus"
                                quick-score-focus.bind="quickScoreFocus"
                                assm-type.bind="assignmentMeta.type"
                                checks.call="quickUpdate(key)">
                  <template replace-part="suggestion">
                    <span style="font-style: italic">${suggestion}</span>
                  </template>
                </autocomplete>
                </div>
            </td>

            <!-- Value Input -->
            <td class="text-center">
                <div class="form-group">
                  <div if.bind="assignmentMeta.type === 'Points'" class="form-group">
                    <input value.bind="quickPoints" class=form-control
                    style="width: 5em;" placeholder="Score"
                    focus.bind="quickScoreFocus" keypress.delegate="quickUpdate($event.which)" />

                  </div>
                  <div if.bind="assignmentMeta.type === 'Checks'">
                    <i class="fa fa-check-circle-o fa-2x" aria-hidden="true"></i>
                  </div>
                </div>
            </td>
          </tr>
        </table>
      </div>
      </div>
</template>
